"use strict";(()=>{var e={};e.id=48,e.ids=[48],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6590:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>R,patchFetch:()=>T,requestAsyncStorage:()=>g,routeModule:()=>y,serverHooks:()=>w,staticGenerationAsyncStorage:()=>E});var n={};r.r(n),r.d(n,{DELETE:()=>f,GET:()=>m,PATCH:()=>h});var s=r(9303),o=r(8716),a=r(3131),i=r(2602),c=r(4953),l=r(6543);let u=[],d=l.Ryn({name:l.Z_8().min(1).max(100).optional(),subject:l.Z_8().min(1).max(200).optional(),body:l.Z_8().min(1).max(1e4).optional(),type:l.KmV(["initial","followup","intro_request","update"]).optional()});function p(e){let t=d.safeParse(e);if(!t.success){let e={};throw t.error.issues.forEach(t=>{let r=t.path.join(".")||"root";e[r]||(e[r]=[]),e[r].push(t.message)}),new i.p8("Validation failed",e)}return t.data}async function m(e,{params:t}){return(0,i.bi)(async()=>{let{id:e}=await t,r=u.find(t=>t.id===e);if(!r)throw new i.dR("Template");return(0,i.Xj)(r)})}async function h(e,{params:t}){return(0,i.bi)(async()=>{let{id:r}=await t,n=await (0,i.Kz)(e,p),s=u.findIndex(e=>e.id===r);if(-1===s)throw new i.dR("Template");let o=u[s];if(!o)throw new i.dR("Template");let a=o.variables;if(n.subject||n.body){let e=n.subject??o.subject,t=n.body??o.body;a=(0,c.cA)(e+" "+t)}let l={...o,...n,variables:a};return u[s]=l,(0,i.Xj)(l)})}async function f(e,{params:t}){return(0,i.bi)(async()=>{let{id:e}=await t,r=u.findIndex(t=>t.id===e);return -1!==r&&u.splice(r,1),(0,i.Xj)({deleted:!0})})}let y=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/templates/[id]/route",pathname:"/api/templates/[id]",filename:"route",bundlePath:"app/api/templates/[id]/route"},resolvedPagePath:"/Users/jessewitkowski/Projects/cap-outro/src/app/api/templates/[id]/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:E,serverHooks:w}=y,R="/api/templates/[id]/route";function T(){return(0,a.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:E})}},2602:(e,t,r)=>{r.d(t,{Kz:()=>u,Xj:()=>i,bi:()=>l,dR:()=>a,p8:()=>o});var n=r(7070);class s extends Error{constructor(e,t,r){super(t),this.code=e,this.details=r,this.name="AppError"}}class o extends s{constructor(e,t){super("VALIDATION_ERROR",e,t),this.name="ValidationError"}}class a extends s{constructor(e){super("NOT_FOUND",`${e} not found`),this.name="NotFoundError"}}function i(e,t){return n.NextResponse.json({success:!0,data:e,...t&&{meta:t}})}function c(e){if(e instanceof s){let t={UNAUTHORIZED:401,FORBIDDEN:403,NOT_FOUND:404,VALIDATION_ERROR:400,RATE_LIMITED:429,INTERNAL_ERROR:500}[e.code];return n.NextResponse.json({success:!1,error:{code:e.code,message:e.message,...e.details&&{details:e.details}}},{status:t})}return console.error("Unhandled error:",e),n.NextResponse.json({success:!1,error:{code:"INTERNAL_ERROR",message:"An unexpected error occurred"}},{status:500})}function l(e){return e().catch(e=>e instanceof s||e instanceof Error?c(e):c(Error("Unknown error")))}async function u(e,t){try{let r=await e.json();return t(r)}catch(e){if(e instanceof o)throw e;throw new o("Invalid JSON body")}}},4953:(e,t,r)=>{r.d(t,{cA:()=>i,Fu:()=>c,Cz:()=>a});class n{constructor(e,t){this.apiKey=e,this.defaultFrom=t??"Cap Outro <noreply@capoutro.com>"}async send(e){try{let t=Array.isArray(e.to)?e.to.map(e=>e.name?`${e.name} <${e.email}>`:e.email):[e.to.name?`${e.to.name} <${e.to.email}>`:e.to.email],r={from:e.from?`${e.from.name??""} <${e.from.email}>`.trim():this.defaultFrom,to:t,subject:e.subject,html:e.html};e.text&&(r.text=e.text),e.replyTo&&(r.reply_to=e.replyTo.name?`${e.replyTo.name} <${e.replyTo.email}>`:e.replyTo.email),e.tags&&e.tags.length>0&&(r.tags=e.tags.map(e=>({name:e,value:"true"}))),e.trackingId&&(r.headers={"X-Tracking-Id":e.trackingId});let n=await fetch("https://api.resend.com/emails",{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(r)}),s=await n.json();if(!n.ok)return{success:!1,error:s.message??`HTTP ${n.status}`};return{success:!0,messageId:s.id}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}}class s{async send(e){return console.log("\uD83D\uDCE7 Mock Email Sent:"),console.log("  To:",Array.isArray(e.to)?e.to.map(e=>e.email).join(", "):e.to.email),console.log("  Subject:",e.subject),console.log("  Tracking ID:",e.trackingId??"none"),console.log("---"),this.sentEmails.push(e),await new Promise(e=>setTimeout(e,100)),{success:!0,messageId:`mock_${Date.now()}_${Math.random().toString(36).slice(2)}`}}getSentEmails(){return this.sentEmails}clearSentEmails(){this.sentEmails=[]}constructor(){this.sentEmails=[]}}let o=null;async function a(e){return(function(){if(!o){let e=process.env.RESEND_API_KEY;e&&"demo"!==e?o=new n(e):(console.log("⚠️ Using mock email provider (no RESEND_API_KEY set)"),o=new s)}return o})().send(e)}function i(e){let t;let r=/\{\{\s*(\w+)\s*\}\}/g,n=[];for(;null!==(t=r.exec(e));){let e=t[1];e&&!n.includes(e)&&n.push(e)}return n}function c(e,t,r={}){let n=e;return!1!==r.trackOpens&&(n=function(e,t){let r=`http://localhost:3000/api/tracking/open?id=${t}`,n=`<img src="${r}" width="1" height="1" style="display:none" alt="" />`;return e.includes("</body>")?e.replace("</body>",`${n}</body>`):e+n}(n,t)),!1!==r.trackClicks&&(n=n.replace(/href="(https?:\/\/[^"]+)"/g,(e,r)=>{let n=`http://localhost:3000/api/tracking/click?id=${t}&url=${encodeURIComponent(r)}`;return`href="${n}"`})),n}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,972,543],()=>r(6590));module.exports=n})();