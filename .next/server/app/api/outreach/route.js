"use strict";(()=>{var e={};e.id=522,e.ids=[522],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6793:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>w,patchFetch:()=>E,requestAsyncStorage:()=>g,routeModule:()=>_,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f});var r={};n.r(r),n.d(r,{GET:()=>m,POST:()=>h});var s=n(9303),o=n(8716),a=n(3131),i=n(2602),c=n(4953),l=n(6543);let u=[{id:"1",campaign_id:"1",investor_id:"1",sequence_id:"1",step_id:"step-1",type:"email",status:"sent",scheduled_at:null,sent_at:new Date(Date.now()-864e5).toISOString(),opened_at:new Date(Date.now()-432e5).toISOString(),replied_at:null,content:"Hi Sarah, I wanted to reach out about our Series A...",subject:"Quick intro - Cap Outro",created_at:new Date().toISOString()},{id:"2",campaign_id:"1",investor_id:"2",sequence_id:null,step_id:null,type:"email",status:"scheduled",scheduled_at:new Date(Date.now()+864e5).toISOString(),sent_at:null,opened_at:null,replied_at:null,content:"Hi Mike, following up on our previous conversation...",subject:"Following up - Cap Outro",created_at:new Date().toISOString()}],d=l.Ryn({campaign_id:l.Z_8().uuid("Invalid campaign ID"),investor_id:l.Z_8().uuid("Invalid investor ID"),sequence_id:l.Z_8().uuid().optional(),step_id:l.Z_8().uuid().optional(),type:l.KmV(["email","linkedin","call","meeting","intro_request"]),content:l.Z_8().min(1,"Content is required").max(1e4),subject:l.Z_8().max(200).optional(),scheduled_at:l.Z_8().datetime().optional(),send_now:l.O72().optional()});function p(e){let t=d.safeParse(e);if(!t.success){let e={};throw t.error.issues.forEach(t=>{let n=t.path.join(".")||"root";e[n]||(e[n]=[]),e[n].push(t.message)}),new i.p8("Validation failed",e)}return t.data}async function m(e){return(0,i.bi)(async()=>{let t=e.nextUrl.searchParams,n=t.get("campaign_id"),r=t.get("investor_id"),s=t.get("status"),o=u;return n&&(o=o.filter(e=>e.campaign_id===n)),r&&(o=o.filter(e=>e.investor_id===r)),s&&(o=o.filter(e=>e.status===s)),(0,i.Xj)(o,{page:1,limit:50,total:o.length})})}async function h(e){return(0,i.bi)(async()=>{let t=await (0,i.Kz)(e,p),n=crypto.randomUUID(),r={id:`outreach-${Date.now()}`,campaign_id:t.campaign_id,investor_id:t.investor_id,sequence_id:t.sequence_id??null,step_id:t.step_id??null,type:t.type,status:t.send_now?"sent":"scheduled",scheduled_at:t.scheduled_at??null,sent_at:t.send_now?new Date().toISOString():null,opened_at:null,replied_at:null,content:t.content,subject:t.subject??null,created_at:new Date().toISOString()};if(t.send_now&&"email"===t.type){let e=(0,c.Fu)(t.content,n),s=await (0,c.Cz)({to:{email:"investor@example.com"},subject:t.subject??"No Subject",html:e,trackingId:n});s.success||(console.error("Failed to send email:",s.error),r.status="scheduled",r.sent_at=null)}return u.push(r),(0,i.Xj)(r)})}let _=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/outreach/route",pathname:"/api/outreach",filename:"route",bundlePath:"app/api/outreach/route"},resolvedPagePath:"/Users/jessewitkowski/Projects/cap-outro/src/app/api/outreach/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:y}=_,w="/api/outreach/route";function E(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},2602:(e,t,n)=>{n.d(t,{Kz:()=>u,Xj:()=>i,bi:()=>l,dR:()=>a,p8:()=>o});var r=n(7070);class s extends Error{constructor(e,t,n){super(t),this.code=e,this.details=n,this.name="AppError"}}class o extends s{constructor(e,t){super("VALIDATION_ERROR",e,t),this.name="ValidationError"}}class a extends s{constructor(e){super("NOT_FOUND",`${e} not found`),this.name="NotFoundError"}}function i(e,t){return r.NextResponse.json({success:!0,data:e,...t&&{meta:t}})}function c(e){if(e instanceof s){let t={UNAUTHORIZED:401,FORBIDDEN:403,NOT_FOUND:404,VALIDATION_ERROR:400,RATE_LIMITED:429,INTERNAL_ERROR:500}[e.code];return r.NextResponse.json({success:!1,error:{code:e.code,message:e.message,...e.details&&{details:e.details}}},{status:t})}return console.error("Unhandled error:",e),r.NextResponse.json({success:!1,error:{code:"INTERNAL_ERROR",message:"An unexpected error occurred"}},{status:500})}function l(e){return e().catch(e=>e instanceof s||e instanceof Error?c(e):c(Error("Unknown error")))}async function u(e,t){try{let n=await e.json();return t(n)}catch(e){if(e instanceof o)throw e;throw new o("Invalid JSON body")}}},4953:(e,t,n)=>{n.d(t,{cA:()=>i,Fu:()=>c,Cz:()=>a});class r{constructor(e,t){this.apiKey=e,this.defaultFrom=t??"Cap Outro <noreply@capoutro.com>"}async send(e){try{let t=Array.isArray(e.to)?e.to.map(e=>e.name?`${e.name} <${e.email}>`:e.email):[e.to.name?`${e.to.name} <${e.to.email}>`:e.to.email],n={from:e.from?`${e.from.name??""} <${e.from.email}>`.trim():this.defaultFrom,to:t,subject:e.subject,html:e.html};e.text&&(n.text=e.text),e.replyTo&&(n.reply_to=e.replyTo.name?`${e.replyTo.name} <${e.replyTo.email}>`:e.replyTo.email),e.tags&&e.tags.length>0&&(n.tags=e.tags.map(e=>({name:e,value:"true"}))),e.trackingId&&(n.headers={"X-Tracking-Id":e.trackingId});let r=await fetch("https://api.resend.com/emails",{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(n)}),s=await r.json();if(!r.ok)return{success:!1,error:s.message??`HTTP ${r.status}`};return{success:!0,messageId:s.id}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}}class s{async send(e){return console.log("\uD83D\uDCE7 Mock Email Sent:"),console.log("  To:",Array.isArray(e.to)?e.to.map(e=>e.email).join(", "):e.to.email),console.log("  Subject:",e.subject),console.log("  Tracking ID:",e.trackingId??"none"),console.log("---"),this.sentEmails.push(e),await new Promise(e=>setTimeout(e,100)),{success:!0,messageId:`mock_${Date.now()}_${Math.random().toString(36).slice(2)}`}}getSentEmails(){return this.sentEmails}clearSentEmails(){this.sentEmails=[]}constructor(){this.sentEmails=[]}}let o=null;async function a(e){return(function(){if(!o){let e=process.env.RESEND_API_KEY;e&&"demo"!==e?o=new r(e):(console.log("⚠️ Using mock email provider (no RESEND_API_KEY set)"),o=new s)}return o})().send(e)}function i(e){let t;let n=/\{\{\s*(\w+)\s*\}\}/g,r=[];for(;null!==(t=n.exec(e));){let e=t[1];e&&!r.includes(e)&&r.push(e)}return r}function c(e,t,n={}){let r=e;return!1!==n.trackOpens&&(r=function(e,t){let n=`http://localhost:3000/api/tracking/open?id=${t}`,r=`<img src="${n}" width="1" height="1" style="display:none" alt="" />`;return e.includes("</body>")?e.replace("</body>",`${r}</body>`):e+r}(r,t)),!1!==n.trackClicks&&(r=r.replace(/href="(https?:\/\/[^"]+)"/g,(e,n)=>{let r=`http://localhost:3000/api/tracking/click?id=${t}&url=${encodeURIComponent(n)}`;return`href="${r}"`})),r}}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[276,972,543],()=>n(6793));module.exports=r})();